# Improvement Recommendations Schema
# Schema for improvement-recommendations.md - actionable improvement recommendations
# Generated by: Reflection agent
# Version: 1.0

improvement_recommendations:
  metadata:
    generated_at: string  # ISO 8601 timestamp
    generated_by: "Reflection Agent"
    version: string
    project: string
    sprint: integer
    period: string  # "Sprint 12" | "Week 2024-W40"

  # Summary
  summary:
    total_recommendations: integer
    by_priority:
      critical: integer
      high: integer
      medium: integer
      low: integer
    by_category:
      domain_truth_updates: integer
      eval_test_improvements: integer
      validation_rule_tuning: integer
      agent_strategy_updates: integer
      workflow_optimizations: integer
      human_checkpoint_tuning: integer
    estimated_total_effort_hours: float
    estimated_impact_score: float  # 0-100

  # Recommendations
  recommendations:
    - recommendation_id: string  # REC-YYYY-NNN
      created_at: string  # ISO 8601
      updated_at: string  # ISO 8601

      # Classification
      category: enum  # domain_truth_updates | eval_test_improvements | validation_rule_tuning | agent_strategy_updates | workflow_optimizations | human_checkpoint_tuning
      subcategory: string
      priority: enum  # critical | high | medium | low

      # Description
      title: string
      description: string

      # Rationale
      rationale:
        trigger: string  # what triggered this recommendation
        evidence:
          - evidence_item: string
            source: string  # failure_id | pattern_id | metric_name

        data_points:
          - metric: string
            value: any
            threshold: any

        pattern_reference: string  # PAT-NNN, null if not pattern-based

      # Suggested action
      suggested_action:
        summary: string
        detailed_steps:
          - step: string
            details: string

        artifacts_to_modify:
          - artifact_type: string  # domain-truth.yaml | eval test | validation rule
            artifact_path: string
            change_type: enum  # add | modify | remove

        code_changes:
          - file: string
            change_description: string
            example_code: string

      # Impact analysis
      impact:
        impact_score: float  # 0-100
        impact_description: string

        problems_prevented:
          - problem: string
            frequency: enum  # always | usually | sometimes | rarely
            severity: enum  # critical | major | minor

        metrics_improved:
          - metric_name: string
            current_value: any
            expected_value: any
            improvement_percentage: float

        time_saved_per_occurrence_hours: float
        estimated_prevention_rate: float  # percentage

      # Effort estimation
      effort:
        effort_level: enum  # low | medium | high
        estimated_hours: float
        complexity: enum  # simple | moderate | complex
        required_skills:
          - skill: string

        dependencies:
          - dependency: string
            type: enum  # technical | approval | coordination

      # ROI calculation
      roi:
        effort_hours: float
        time_saved_per_sprint_hours: float
        payback_period_sprints: float
        roi_score: float  # time_saved / effort

      # Implementation
      implementation:
        status: enum  # pending | approved | in_progress | implemented | rejected | deferred
        assigned_to: string
        target_sprint: integer

        approval_required: boolean
        approved_by: string
        approved_at: string  # ISO 8601

        implemented_at: string  # ISO 8601
        implementation_notes: string

      # Verification
      verification:
        verification_method: string
        success_criteria:
          - criterion: string
            metric: string
            target_value: any

        verified: boolean
        verification_date: string
        verification_outcome: string

      # Follow-up
      follow_up:
        monitor_metrics:
          - metric: string
            duration: string

        expected_results:
          - result: string
            timeframe: string

        actual_results:
          - result: string
            observed_at: string

  # Domain truth update recommendations
  domain_truth_updates:
    - recommendation_id: string
      title: string
      priority: enum

      missing_facts:
        - fact_category: string
          fact_description: string
          suggested_fact_id: string
          yaml_snippet: string

      incorrect_facts:
        - fact_id: string
          current_value: string
          corrected_value: string
          yaml_snippet: string

      new_constraints:
        - constraint_description: string
          yaml_snippet: string

      rationale: string
      impact: string
      effort: enum

  # Eval test improvement recommendations
  eval_test_improvements:
    - recommendation_id: string
      title: string
      priority: enum

      coverage_gaps:
        - fact_id: string
          fact_description: string
          suggested_test_name: string
          test_outline: string

      test_quality_issues:
        - test_name: string
          issue: string
          suggested_fix: string
          code_example: string

      new_test_categories:
        - category: string
          rationale: string
          example_tests:
            - test_name: string
              test_outline: string

      rationale: string
      impact: string
      effort: enum

  # Validation rule tuning recommendations
  validation_rule_tuning:
    - recommendation_id: string
      title: string
      priority: enum

      oracle_rules:
        - rule_name: string
          current_threshold: any
          suggested_threshold: any
          rationale: string

      validator_rules:
        - rule_name: string
          issue: string
          suggested_change: string

      gate_thresholds:
        - gate_name: string
          current_threshold: any
          suggested_threshold: any
          rationale: string

      rationale: string
      impact: string
      effort: enum

  # Agent strategy update recommendations
  agent_strategy_updates:
    - recommendation_id: string
      title: string
      priority: enum

      agent: string  # oracle | eval | validator | monitor | reflection
      current_behavior: string
      suggested_behavior: string

      strategy_changes:
        - aspect: string
          current: string
          proposed: string

      expected_improvement:
        - metric: string
          current_value: any
          expected_value: any

      rationale: string
      impact: string
      effort: enum

  # Workflow optimization recommendations
  workflow_optimizations:
    - recommendation_id: string
      title: string
      priority: enum

      bottleneck_identified: string
      current_workflow: string
      optimized_workflow: string

      changes:
        - phase: string
          current_process: string
          optimized_process: string
          time_savings_hours: float

      automation_opportunities:
        - task: string
          current_manual_effort_hours: float
          automation_effort_hours: float
          recurring_frequency: string

      rationale: string
      impact: string
      effort: enum

  # Human checkpoint tuning recommendations
  human_checkpoint_tuning:
    - recommendation_id: string
      title: string
      priority: enum

      checkpoint: string
      current_frequency: string
      suggested_frequency: string

      rationale: string

      trade_offs:
        autonomy_increase: string
        risk_increase: string
        mitigation: string

      impact: string
      effort: enum

  # Implementation roadmap
  roadmap:
    immediate_actions:  # within 1 sprint
      - recommendation_id: string
        title: string
        priority: "critical"
        effort_hours: float

    short_term:  # 1-3 sprints
      - recommendation_id: string
        title: string
        priority: enum
        effort_hours: float

    long_term:  # 3+ sprints
      - recommendation_id: string
        title: string
        priority: enum
        effort_hours: float

# Enums
enums:
  category: [domain_truth_updates, eval_test_improvements, validation_rule_tuning, agent_strategy_updates, workflow_optimizations, human_checkpoint_tuning]
  priority: [critical, high, medium, low]
  effort_level: [low, medium, high]
  complexity: [simple, moderate, complex]
  status: [pending, approved, in_progress, implemented, rejected, deferred]
  severity: [critical, major, minor]
  frequency: [always, usually, sometimes, rarely]
  change_type: [add, modify, remove]
