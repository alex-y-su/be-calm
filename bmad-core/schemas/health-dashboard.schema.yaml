# Health Dashboard Schema
# Schema for health-dashboard.yaml - comprehensive system health snapshot
# Generated by: Monitor agent
# Version: 1.0

health_dashboard:
  metadata:
    generated_at: string  # ISO 8601 timestamp
    generated_by: "Monitor Agent"
    version: string
    project: string
    sprint: integer
    phase: string

  # Overall health status
  overall_health:
    status: enum  # healthy | warning | critical
    score: integer  # 0-100
    summary: string

  # Truth alignment metrics
  truth_alignment:
    domain_truth_alignment_score:
      value: integer  # 0-100
      threshold: integer  # 85
      status: enum  # ok | warning | critical
      trend: enum  # improving | stable | degrading

    requirements_traceability_score:
      value: integer  # 0-100
      threshold: integer  # 95
      status: enum
      trend: enum
      gaps:
        - requirement_id: string
          description: string

    eval_test_coverage:
      value: integer  # 0-100
      threshold: integer  # 90
      status: enum
      trend: enum
      uncovered_facts:
        - fact_id: string
          description: string

    validation_chain_integrity:
      value: integer  # 0-100
      threshold: integer  # 95
      status: enum
      trend: enum
      broken_chains:
        - chain_id: string
          break_point: string

  # Code quality metrics
  code_quality:
    overall_score: integer  # 0-100
    status: enum

    complexity_score:
      average: float
      max: float
      threshold: integer  # 10
      status: enum
      trend: enum
      high_complexity_functions:
        - function: string
          complexity: integer
          file: string
          line: integer

    duplication_rate:
      value: float  # percentage
      threshold: float  # 10.0
      status: enum
      trend: enum

    test_coverage:
      value: float  # percentage
      threshold: float  # 70.0
      status: enum
      trend: enum
      uncovered_files:
        - file: string
          coverage: float

    documentation_coverage:
      value: float  # percentage
      threshold: float  # 75.0
      status: enum
      trend: enum
      undocumented_functions:
        - function: string
          file: string
          line: integer

  # Performance metrics
  performance:
    overall_status: enum
    degradation_from_baseline: float  # percentage

    response_time_p95:
      current: float  # milliseconds
      baseline: float
      degradation: float  # percentage
      threshold: float  # 10.0
      status: enum
      trend: enum

    response_time_p99:
      current: float
      baseline: float
      degradation: float
      threshold: float  # 15.0
      status: enum
      trend: enum

    throughput:
      current: float  # req/s
      baseline: float
      degradation: float
      threshold: float  # -10.0 (10% reduction)
      status: enum
      trend: enum

    error_rate:
      current: float  # percentage
      threshold: float  # 2.0
      status: enum
      trend: enum
      recent_errors:
        - timestamp: string
          type: string
          message: string
          count: integer

  # Validation health metrics
  validation_health:
    overall_status: enum

    eval_test_pass_rate:
      value: float  # percentage
      threshold: float  # 90.0
      status: enum
      trend: enum
      failing_tests:
        - test: string
          failure_message: string
          first_failed: string

    oracle_validation_success:
      value: float  # percentage
      threshold: float  # 95.0
      status: enum
      trend: enum
      recent_blocks:
        - artifact: string
          reason: string
          timestamp: string

    validator_traceability_success:
      value: float  # percentage
      threshold: float  # 98.0
      status: enum
      trend: enum

    gate_pass_rate:
      value: float  # percentage
      threshold: float  # 85.0
      status: enum
      trend: enum
      failed_gates:
        - story: string
          gate: string
          reason: string
          timestamp: string

  # Agent performance metrics
  agent_performance:
    overall_status: enum

    oracle_accuracy:
      value: float  # percentage
      threshold: float  # 90.0
      status: enum
      trend: enum

    eval_test_quality:
      value: float  # percentage
      threshold: float  # 80.0
      status: enum
      trend: enum

    validator_false_positives:
      value: float  # percentage
      threshold: float  # 10.0
      status: enum
      trend: enum

    reflection_insight_quality:
      value: float  # percentage
      threshold: float  # 70.0
      status: enum
      trend: enum

  # Active alerts
  alerts:
    critical:
      - alert_id: string
        message: string
        timestamp: string
        metric: string
        value: any
        threshold: any

    warning:
      - alert_id: string
        message: string
        timestamp: string
        metric: string
        value: any
        threshold: any

    info:
      - alert_id: string
        message: string
        timestamp: string
        metric: string

  # Trends (last 7 days)
  trends:
    overall_health_trend: enum  # improving | stable | degrading
    metrics_improving:
      - metric_name: string
        improvement: float  # percentage

    metrics_degrading:
      - metric_name: string
        degradation: float  # percentage

  # Recommendations
  recommendations:
    immediate_action_required:
      - recommendation: string
        reason: string
        priority: "critical"

    suggested_improvements:
      - recommendation: string
        reason: string
        priority: enum  # high | medium | low

  # Historical comparison
  history:
    previous_health_score: integer
    score_change: integer
    days_since_last_critical: integer
    total_alerts_this_week: integer
    total_alerts_last_week: integer

# Enums
enums:
  status: [healthy, ok, warning, critical]
  trend: [improving, stable, degrading]
  priority: [critical, high, medium, low]
