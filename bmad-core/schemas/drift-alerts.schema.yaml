# Drift Alerts Schema
# Schema for drift-alerts.md - real-time drift detection alerts
# Generated by: Monitor agent
# Version: 1.0

drift_alerts:
  metadata:
    generated_at: string  # ISO 8601 timestamp
    generated_by: "Monitor Agent"
    version: string
    project: string

  # Active alerts
  active_alerts:
    - alert_id: string  # ALERT-YYYY-MM-DD-NNN
      timestamp: string  # ISO 8601
      severity: enum  # critical | warning | info
      category: enum  # semantic_drift | requirement_drift | architecture_drift | test_drift
      status: enum  # active | acknowledged | resolved

      # Alert details
      title: string
      message: string
      description: string

      # Metrics
      metric_name: string
      current_value: any
      threshold_value: any
      deviation: float  # percentage or absolute

      # Context
      affected_artifacts:
        - artifact_type: string  # file | component | module
          artifact_path: string
          artifact_name: string

      trigger:
        event: string  # file_save | commit | validation_gate
        trigger_details: string

      # Actions
      action_required: enum  # block | notify | log
      recommended_actions:
        - action: string
          priority: enum  # immediate | soon | when_convenient

      # Resolution
      resolved_at: string  # ISO 8601, null if not resolved
      resolved_by: string
      resolution_notes: string

  # Alert summary
  summary:
    total_active: integer
    by_severity:
      critical: integer
      warning: integer
      info: integer
    by_category:
      semantic_drift: integer
      requirement_drift: integer
      architecture_drift: integer
      test_drift: integer

  # Drift categories detailed

  semantic_drift_alerts:
    - alert_id: string
      timestamp: string
      severity: enum

      # Semantic drift specifics
      artifact: string
      domain_truth_alignment_score: float  # 0-1
      threshold: float  # 0.85
      deviation: float  # percentage below threshold

      affected_domain_facts:
        - fact_id: string
          fact_description: string
          alignment_score: float

      embedding_analysis:
        artifact_embedding_summary: string
        truth_embedding_summary: string
        divergence_points:
          - concept: string
            artifact_interpretation: string
            truth_interpretation: string

      recommended_actions:
        - action: string
          details: string

  requirement_drift_alerts:
    - alert_id: string
      timestamp: string
      severity: enum

      # Requirement drift specifics
      divergence_percentage: float
      uncovered_functionality:
        - functionality: string
          location: string  # file:line
          description: string
          prd_reference: string  # null if not in PRD

      prd_requirements_not_implemented:
        - requirement_id: string
          requirement_description: string
          expected_location: string

      recommended_actions:
        - action: enum  # update_prd | remove_code | add_implementation
          details: string

  architecture_drift_alerts:
    - alert_id: string
      timestamp: string
      severity: enum

      # Architecture drift specifics
      component_deviation_percentage: float
      new_components_not_in_architecture:
        - component_name: string
          component_type: string
          location: string
          dependencies:
            - dependency: string

      architecture_components_not_implemented:
        - component_name: string
          component_description: string
          expected_location: string

      architectural_pattern_violations:
        - pattern: string
          violation: string
          location: string

      recommended_actions:
        - action: enum  # update_architecture | refactor_code | remove_component
          details: string

  test_drift_alerts:
    - alert_id: string
      timestamp: string
      severity: enum

      # Test drift specifics
      eval_test_coverage: float  # percentage
      threshold: float  # 90.0
      coverage_drop: float  # percentage

      uncovered_domain_facts:
        - fact_id: string
          fact_description: string
          category: string

      failing_eval_tests:
        - test_name: string
          failure_message: string
          related_fact_id: string

      test_quality_issues:
        - issue: string
          test_name: string
          recommendation: string

      recommended_actions:
        - action: enum  # add_tests | fix_tests | update_truth
          details: string

  # Historical alerts (resolved)
  resolved_alerts:
    - alert_id: string
      timestamp: string
      resolved_at: string
      severity: enum
      category: enum
      resolution_time_minutes: integer
      resolution: string

  # Alert trends
  trends:
    alerts_last_24h: integer
    alerts_last_7d: integer
    alerts_last_30d: integer

    most_common_category: string
    most_common_severity: string

    average_resolution_time_minutes: float
    unresolved_critical_count: integer

# Enums
enums:
  severity: [critical, warning, info]
  category: [semantic_drift, requirement_drift, architecture_drift, test_drift]
  status: [active, acknowledged, resolved]
  action_required: [block, notify, log]
  priority: [immediate, soon, when_convenient]
